# ScanPang 앱 긴급 수정 요청

실제 기기에서 앱을 녹화해서 확인한 결과, 아래 버그들이 발견됐다. 우선순위 순서대로 수정해줘.

---

## 🔴 P0 — 크리티컬 (앱 핵심 기능 불능)

### 1. AR 스캔 화면 카메라 프리뷰가 검은 화면으로 나옴
- **현상**: AR 스캔 진입 시 카메라 배경이 렌더링되지 않고 **검정 화면** 위에 건물 라벨만 떠 있음. 간헐적으로 카메라가 잠깐 보이다가 다시 검정으로 돌아감.
- **기대 동작**: 전체화면 카메라 프리뷰가 항상 배경에 보이고, 그 위에 AR 라벨이 오버레이 되어야 함.
- **확인할 것**:
  - `expo-camera`의 `CameraView` 컴포넌트가 `position: absolute`로 전체 화면을 덮고 있는지
  - 카메라 컴포넌트의 z-index가 AR 라벨 레이어보다 아래에 있는지
  - 카메라 `onCameraReady` 이벤트 전에 다른 레이어가 카메라를 가리고 있지 않은지
  - Reanimated 애니메이션이 카메라 뷰 위에서 불투명 배경을 렌더링하고 있지 않은지
  - `CameraView`의 `style`에 `flex: 1` 또는 명시적 width/height가 설정되어 있는지

### 2. 건물 라벨 카드 겹침 심각
- **현상**: 여러 건물이 같은 방향에 있을 때 라벨 카드들이 서로 완전히 겹쳐서 읽을 수 없음. A동, B동, 다동, C동 등이 같은 위치에 뭉쳐있음.
- **기대 동작**: 가까운 건물 라벨이 크게, 먼 건물이 작게 표시되면서 **서로 겹치지 않게 오프셋** 되어야 함.
- **수정 방향**:
  - 겹침 방지 알고리즘이 실제로 적용되고 있는지 확인 — 현재 코드에서 collision detection 로직 확인
  - 같은 방위각 범위에 여러 건물이 있을 때 수직으로 오프셋 (stacking)
  - 화면 밖으로 나가는 라벨은 클리핑하거나 숨기기
  - 겹치는 건물이 3개 이상이면 가장 가까운 2~3개만 표시하고 나머지는 "외 N개" 같은 클러스터 표시 고려

---

## 🟡 P1 — 중요 (데이터 파이프라인 미연결)

### 3. Flywheel 자동 DB 구축이 실제로 작동하지 않음
- **현상**: 홈 화면에 "오늘 스캔 5회"로 표시되는데 Flywheel Dashboard는 총 소싱 0, 검증률 0%, 커버리지 0개, 24h 활동 0으로 전부 비어있음.
- **확인할 것**:
  - AR 스캔 시 Gemini Vision 분석 API가 실제로 호출되고 있는지 (네트워크 로그 확인)
  - 분석 결과가 confidence ≥ 0.5일 때 자동 소싱 → DB 저장 로직이 실제로 트리거 되는지
  - `/api/flywheel/stats` 엔드포인트가 올바른 데이터를 반환하는지
  - 프론트에서 Dashboard 렌더 시 API 호출이 제대로 되는지

### 4. 홈 화면 "주변 건물" 섹션 로딩 실패
- **현상**: 주변 건물 가로 스크롤 영역이 스켈레톤/로딩 스피너만 돌고 실제 건물 카드가 표시되지 않음.
- **확인할 것**:
  - 홈 화면에서 주변 건물 API 호출이 성공하는지
  - OSM Overpass API 호출 또는 DB 조회가 타임아웃 나고 있지 않은지
  - 에러 핸들링이 되어 있는지 (현재는 에러 시에도 스켈레톤만 계속 보임 → 에러 상태 UI 추가 필요)

---

## 🟢 P2 — 개선 (UX 품질)

### 5. 건물 이름이 "A동", "B동" 등 동 번호로만 표시됨
- **현상**: AR 라벨에 건물 이름이 전부 "A동", "B동", "C동", "다동" + "건물" 타입으로만 나옴. 아파트 단지명이나 실제 건물명이 없음.
- **수정 방향**:
  - OSM 데이터에서 가져올 때 `name` 태그가 없으면 `addr:street` + `addr:housenumber` 조합 사용
  - 아파트 단지의 경우 상위 relation의 `name` (예: "이매촌 한신아파트") 을 가져와서 "이매촌한신 A동" 형태로 표시
  - DB에 있는 건물은 Gemini 분석 결과의 건물명을 우선 사용
  - "건물" 이라는 기본 타입 대신, OSM `building` 태그값 활용 (apartment → 아파트, commercial → 상업, retail → 상가 등)

### 6. AR HUD 상태 표시 개선
- **현상**: "7-Factor" 텍스트가 초록색 점과 함께 표시되지만, 실제 7-Factor 값이나 세부 상태가 안 보임. "이동중" 상태 전환은 잘 됨.
- **수정 방향**:
  - "7-Factor" 옆에 현재 종합 점수(0~100) 표시 (예: "7-Factor 82")
  - 탭하면 각 Factor별 상태 미니 패널 (GPS ✅, 나침반 ✅, 자이로 ⚠️ 등)

### 7. 한도 표시 "250/500" 줄바꿈 문제
- **현상**: 홈 화면 상단 파란 카드에서 "250/500"이 "250/50" + "0"으로 줄바꿈 됨.
- **수정**: 해당 텍스트에 `numberOfLines={1}` 추가하거나 카드 너비/폰트 사이즈 조정.

---

## 수정 후 확인 체크리스트

- [ ] AR 스캔 화면 진입 시 카메라 프리뷰가 즉시 전체화면으로 보이는지
- [ ] 건물 라벨이 카메라 위에 오버레이 되어 보이는지 (검정 배경 X)
- [ ] 건물 라벨 5개 이상일 때 겹치지 않고 읽을 수 있는지
- [ ] 스캔 후 Flywheel Dashboard 수치가 올라가는지
- [ ] 홈 화면 주변 건물이 실제로 로딩되는지
- [ ] 건물명이 "A동" 대신 의미 있는 이름으로 표시되는지
